@page
@model web_test.Pages.IndexModel
@{
    // Устанавливаем заголовок страницы
    ViewData["Title"] = "Главная страница";
    // Используем Layout. Убедитесь, что в вашем _Layout.cshtml прописано .container-fluid или нет .container
    Layout = "_Layout.cshtml";
}

<!--
  Можно дополнительно обернуть в container-fluid,
  если в вашем Layout нет нужных классов:
-->
<div class="container-fluid">

    <!-- Шапка: название подразделения, текущий пользователь, выбор даты, исполнителя, поиск -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex flex-wrap align-items-center justify-content-between bg-light p-3 rounded">
                <!-- Название подразделения -->
                <div>
                    <h5 class="mb-0">Подразделение: @Model.DepartmentName</h5>
                    <!-- Вывод текущего авторизованного пользователя -->
                    <p class="text-muted mb-0">Текущий пользователь: @User?.Identity?.Name</p>
                </div>

                <!-- Форма с фильтрами (здесь сделаем method="get", чтобы при обновлении сохранялись данные в URL) -->
                <!-- Форма с фильтрами (здесь сделаем method="get") -->
                <form method="get" class="d-flex flex-wrap align-items-end gap-2">
                    <!-- Выбор периода (дата с ... по ...) -->
                    <div class="d-flex flex-column">
                        <label for="startDate" class="form-label">C даты:</label>
                        <input type="date" class="form-control" id="startDate" name="StartDate"
                               value="@(Model.StartDate.HasValue ? Model.StartDate.Value.ToString("yyyy-MM-dd") : null)" />
                    </div>
                    <div class="d-flex flex-column">
                        <label for="endDate" class="form-label">по дату:</label>
                        <input type="date" class="form-control" id="endDate" name="EndDate"
                               value="@(Model.EndDate.HasValue ? Model.EndDate.Value.ToString("yyyy-MM-dd") : null)" />
                    </div>

                    <!-- Выбор исполнителя (пока статичный пример) -->
                    <div class="d-flex flex-column">
                        <label for="executor" class="form-label">Исполнитель:</label>
                        <select id="executor" name="executor" class="form-select">
                            <option value="">Все исполнители</option>
                            <option value="1">Исполнитель 1</option>
                            <option value="2">Исполнитель 2</option>
                            <option value="3">Исполнитель 3</option>
                        </select>
                    </div>

                    <!-- Строка поиска (пока заглушка) -->
                    <div class="d-flex flex-column">
                        <label for="search" class="form-label">Поиск:</label>
                        <input type="text" class="form-control" id="search" placeholder="Поиск по работам..." />
                    </div>

                    <!-- Кнопка фильтрации или поиска -->
                    <button type="submit" class="btn btn-primary align-self-center">Применить</button>

                    <!-- Кнопка &laquo;Выход&raquo; -->
                    <a asp-page="./Index"
                            asp-page-handler="Logout"
                            class="btn btn-outline-danger align-self-center">
                        Выход
                    </a>
                </form>
            </div>
        </div>
    </div>

    <!-- Основная большая таблица -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle text-center">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">№</th>
                            <th scope="col">Наименование документа</th>
                            <th scope="col">Наименование работы</th>
                            <th scope="col">Исполнитель</th>
                            <th scope="col">Контролирующий</th>
                            <th scope="col">Принимающий</th>
                            <th scope="col">Плановая дата</th>
                            <th scope="col">Корректировка 1</th>
                            <th scope="col">Корректировка 2</th>
                            <th scope="col">Корректировка 3</th>
                            <th scope="col">Фактическая дата</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.WorkItems == null || Model.WorkItems.Count == 0)
                        {
                            <tr>
                                <td colspan="11" class="text-muted">Нет данных</td>
                            </tr>
                        }
                        else
                        {
                            int index = 1;
                            foreach (var item in Model.WorkItems)
                            {
                                <tr>
                                    <td>@index</td>
                                    <td>@item.DocumentName</td>
                                    <td>@item.WorkName</td>
                                    <td>@item.Executor</td>
                                    <td>@item.Controller</td>
                                    <td>@item.Approver</td>
                                    <td>@item.PlanDate?.ToString("dd.MM.yyyy")</td>
                                    <td>@item.Korrect1?.ToString("dd.MM.yyyy")</td>
                                    <td>@item.Korrect2?.ToString("dd.MM.yyyy")</td>
                                    <td>@item.Korrect3?.ToString("dd.MM.yyyy")</td>
                                    <td>@item.FactDate?.ToString("dd.MM.yyyy")</td>
                                </tr>
                                index++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Таблица уведомлений (поменьше) -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6">
            <div class="table-responsive">
                <table class="table table-striped align-middle">
                    <thead class="table-success">
                        <tr>
                            <th scope="col">Напоминание</th>
                            <th scope="col">Дата</th>
                            <th scope="col">Кому</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Аналогично: динамическое заполнение в будущем -->
                        <tr>
                            <td colspan="3" class="text-muted">Нет уведомлений</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Кнопки внизу страницы -->
    <div class="row mb-4">
        <div class="col-12 d-flex gap-3">
            <!-- Кнопка 1: Сформировать сдаточный чек -->
            <button type="button" class="btn btn-success shadow-sm"
                    style="transition: transform 0.2s;"
                    onmousedown="this.style.transform='scale(0.95)'"
                    onmouseup="this.style.transform='scale(1)'"
                    onclick="showReportAndPrint()">
                Сформировать сдаточный чек
            </button>

            <!-- Кнопка 2: Обновить (повторно загрузить страницу) -->
            <form method="get">
                <button type="submit" class="btn btn-secondary shadow-sm"
                        style="transition: transform 0.2s;"
                        onmousedown="this.style.transform='scale(0.95)'"
                        onmouseup="this.style.transform='scale(1)'">
                    Обновить
                </button>
            </form>
        </div>
    </div>

    <!-- Скрытый блок для "Отчёта" (сдаточного чека) -->
    <div id="reportBlock" class="border p-3" style="display: none;">
        <h4>Сдаточный чек</h4>
        <p>Дата формирования: @DateTime.Now.ToString("dd.MM.yyyy HH:mm")</p>
        <p>
            Период:
            @if (Model.StartDate.HasValue && Model.EndDate.HasValue)
            {
                @($"{Model.StartDate.Value:dd.MM.yyyy} - {Model.EndDate.Value:dd.MM.yyyy}")
            }
            else
            {
                <text>не задан</text>
            }
        </p>

        <hr />

        <!-- Можно вывести ту же таблицу или какую-то сокращённую форму данных -->
        <table class="table table-sm table-bordered">
            <thead>
                <tr>
                    <th>Документ fsdfsdf</th>
                    <th>Работа</th>
                    <th>Исполнитель</th>
                    <th>Плановая дата</th>
                    <th>Корректировка 1</th>
                    <th>Корректировка 2</th>
                    <th>Корректировка 3</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.WorkItems)
                {
                    <tr>
                        <td>@item.DocumentName</td>
                        <td>@item.WorkName</td>
                        <td>@item.Executor</td>
                        <td>@item.PlanDate?.ToString("dd.MM.yyyy")</td>
                        <td>@item.Korrect1?.ToString("dd.MM.yyyy")</td>
                        <td>@item.Korrect2?.ToString("dd.MM.yyyy")</td>
                        <td>@item.Korrect3?.ToString("dd.MM.yyyy")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div> <!-- /container-fluid -->


@* @section Scripts { *@
@*         <script> *@
@*             // Показываем скрытый блок и отправляем на печать *@
@*             function showReportAndPrint() { *@
@*                 const reportBlock = document.getElementById("reportBlock"); *@
@*                 reportBlock.style.display = "block"; *@
@*                 window.print(); *@
@*             } *@
@*         </script> *@
@* } *@